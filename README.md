# Comment System Frontend

Фронтенд для системы комментариев на React + TypeScript + Vite.

## Возможности

- ✅ Регистрация и аутентификация пользователей
- ✅ Создание и управление темами (threads)
- ✅ Древовидная структура комментариев
- ✅ Редактирование и удаление комментариев
- ✅ Профиль пользователя с аватарами
- ✅ Пагинация для списков тем и комментариев
- ✅ Адаптивный дизайн

## Настройка

### Переменные окружения

Создайте файл `.env` в корне проекта на основе `.env.example`:

```env
# Базовый URL API для прямых запросов (без прокси)
# Для HTTPS (рекомендуется):
VITE_API_BASE_URL=https://localhost:7042

# Для HTTP (альтернатива):
# VITE_API_BASE_URL=http://localhost:5140

# Целевой адрес для прокси Vite (используется только если VITE_API_BASE_URL не указан)
# Для Docker с HTTPS:
VITE_PROXY_TARGET=https://172.19.0.2:54367

# Для локальной разработки с HTTPS:
# VITE_PROXY_TARGET=https://localhost:7042
```

**Важно:** 
- Если `VITE_API_BASE_URL` указан, запросы идут напрямую на этот адрес
- Если `VITE_API_BASE_URL` не указан, используется прокси Vite с адресом из `VITE_PROXY_TARGET`

### Установка и запуск

```bash
# Установка зависимостей
npm install

# Запуск dev сервера
npm run dev

# Сборка для продакшена
npm run build

# Просмотр собранного приложения
npm run preview
```

## Структура проекта

```
src/
├── components/          # React компоненты
│   ├── Auth/           # Компоненты аутентификации (Login, Register)
│   ├── Comments/       # Компоненты комментариев (CommentTree, CommentItem, CommentForm)
│   ├── Layout/         # Компоненты layout (Header, Layout)
│   ├── Profile/        # Компоненты профиля (Profile, ProfileEdit)
│   └── Threads/        # Компоненты тем (ThreadList, ThreadDetail, ThreadCreate)
├── config/              # Конфигурация (API URL)
├── contexts/            # React contexts (AuthContext)
├── services/            # API сервисы
├── types/               # TypeScript типы
├── utils/               # Утилиты (commentTree, dateFormat)
├── App.tsx              # Главный компонент приложения
└── main.tsx             # Точка входа
```

## API Документация

Подробная документация API находится в файле [FRONTEND_API_DOCUMENTATION.md](./FRONTEND_API_DOCUMENTATION.md).

### Основные endpoints

- `POST /api/auth/register/` - Регистрация
- `POST /api/auth/login/` - Вход
- `POST /api/auth/logout/` - Выход
- `GET /threads/` - Список тем
- `GET /threads/{id}/` - Детали темы с комментариями
- `POST /threads/` - Создание темы
- `PUT /threads/{id}/` - Обновление темы
- `DELETE /threads/{id}/` - Удаление темы
- `GET /threads/{threadId}/comments/` - Комментарии темы
- `POST /comments/` - Создание комментария
- `PUT /comments/{id}/` - Обновление комментария
- `DELETE /comments/{id}/` - Удаление комментария
- `GET /profile/` - Профиль пользователя
- `PUT /profile/avatar/` - Обновление аватара

## Особенности реализации

### Аутентификация

- JWT токены хранятся в HTTP-only cookies
- Автоматическая проверка аутентификации при загрузке приложения
- Защищенные маршруты через `ProtectedRoute` компонент

### Комментарии

- Древовидная структура комментариев с поддержкой вложенности
- Автоматическое построение дерева из плоского списка
- Редактирование и удаление только своих комментариев

### Темы

- Пагинация с бесконечной прокруткой
- Фильтрация по дате создания
- Отображение количества комментариев

### Профиль

- Просмотр профиля любого пользователя
- Редактирование своего профиля (аватар)
- Список тем пользователя

## Технологии

- **React 19** - UI библиотека
- **TypeScript** - типизация
- **Vite** - сборщик и dev сервер
- **React Router** - маршрутизация
- **Axios** - HTTP клиент
- **CSS Modules** - стилизация

## Разработка

### Формат URL

API требует, чтобы все URL были в нижнем регистре и заканчивались на `/` (trailing slash). Это автоматически обрабатывается в `config/api.ts`.

### HTTPS и SSL сертификаты

При использовании HTTPS с самоподписанными сертификатами:
- В `vite.config.ts` установлено `secure: false` для всех прокси
- Это позволяет работать с самоподписанными сертификатами без ошибок SSL
- Все прокси настроены на использование HTTPS (`https://172.19.0.2:54367` или из `VITE_PROXY_TARGET`)

### CORS

API настроен для работы с фронтендом. Убедитесь, что используете `credentials: 'include'` в запросах (это настроено в `services/api.ts`).

### Обработка ошибок

Все ошибки API обрабатываются централизованно через Axios interceptors. Ошибки валидации отображаются пользователю.

## Лицензия

MIT
